<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="./assets/images/icon.png" type="image/png" />
    <title>Art Class</title>

    <link rel="stylesheet" href="./css/master.css" />
    <script src="/uv/uv.bundle.js" charset="UTF-8"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="./js/preload.js"></script>
    
  </head>

  <body>
    <nav>
      <div class="logo">
        <a href="/">
          <img src="./assets/images/icon.png" alt="Logo" draggable="false" />
          <h1>Art Class</h1>
        </a>
      </div>

      <p id="time"></p>

      <div class="navitems">
        <div class="navitem"><a href="/">Home</a></div>
        <div class="navitem"><a selected href="/gs.html">Games</a></div>
        <div class="navitem"><a href="/apps.html">Apps</a></div>
        <div class="navitem"><a href="/search.html">Search</a></div>
        <div class="navitem"><a href="/settings.html">Settings</a></div>
      </div>
    </nav>

    <h1>Games</h1>
    <div class="search-container" style="position: relative; display: inline-block;">
      <input type="text" class="input" id="search" placeholder="Search Games" style="text-align: center" autocomplete="off" />
      <div id="suggestions" class="suggestions-dropdown" style="display: none;"></div>
    </div>

    <div class="cardgroup" id="favoritedgames"></div>
    <div class="cardgroup" id="gamecards"></div>
  </body>

  <script src="./js/index.js"></script>
  <script src="./assets/data/games.js"></script>
  <script src="./js/games.js"></script>

  <style>
    .suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #111;
      border: 1px solid #333;
      border-radius: 5px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      margin-top: 2px;
    }

    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      color: white;
      border-bottom: 1px solid #333;
      transition: background-color 0.2s;
    }

    .suggestion-item:hover,
    .suggestion-item.highlighted {
      background-color: #0284d4;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .search-container {
      width: 500px;
    }
  </style>

  <script>
    const searchInput = document.querySelector('#search')
    const suggestionsContainer = document.querySelector('#suggestions')
    const items = document.querySelectorAll('.card')
    let currentHighlight = -1
    let allGameTitles = []

    // Wait for games to load, then extract titles
    setTimeout(() => {
      const gameCards = document.querySelectorAll('.card h4')
      allGameTitles = Array.from(gameCards).map(card => card.textContent)
    }, 100)

    function showSuggestions(query) {
      if (!query.trim()) {
        hideSuggestions()
        return
      }

      const matches = allGameTitles
        .filter(title => title.toLowerCase().includes(query.toLowerCase()))
        .slice(0, 5) // Limit to 5 suggestions

      if (matches.length === 0) {
        hideSuggestions()
        return
      }

      suggestionsContainer.innerHTML = matches
        .map((title, index) => `<div class="suggestion-item" data-index="${index}">${title}</div>`)
        .join('')

      suggestionsContainer.style.display = 'block'
      currentHighlight = -1
    }

    function hideSuggestions() {
      suggestionsContainer.style.display = 'none'
      currentHighlight = -1
    }

    function highlightSuggestion(index) {
      const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item')
      suggestions.forEach((item, i) => {
        item.classList.toggle('highlighted', i === index)
      })
      currentHighlight = index
    }

    function selectSuggestion(title) {
      searchInput.value = title
      hideSuggestions()
      filterGames(title)
    }

    function filterGames(query) {
      const lowerQuery = query.toLowerCase()

      items.forEach(function (item) {
        const title = item.querySelector('.card h4').textContent.toLowerCase()

        if (title.includes(lowerQuery)) {
          item.style.display = 'block'
        } else {
          item.style.display = 'none'
        }
      })
    }

    // Event listeners
    searchInput.addEventListener('input', function (event) {
      const query = event.target.value
      showSuggestions(query)
      filterGames(query)
    })

    searchInput.addEventListener('keydown', function (event) {
      const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item')

      if (event.key === 'ArrowDown') {
        event.preventDefault()
        if (currentHighlight < suggestions.length - 1) {
          highlightSuggestion(currentHighlight + 1)
        }
      } else if (event.key === 'ArrowUp') {
        event.preventDefault()
        if (currentHighlight > 0) {
          highlightSuggestion(currentHighlight - 1)
        }
      } else if (event.key === 'Enter') {
        event.preventDefault()
        if (currentHighlight >= 0 && suggestions[currentHighlight]) {
          selectSuggestion(suggestions[currentHighlight].textContent)
        }
      } else if (event.key === 'Escape') {
        hideSuggestions()
      }
    })

    suggestionsContainer.addEventListener('click', function (event) {
      if (event.target.classList.contains('suggestion-item')) {
        selectSuggestion(event.target.textContent)
      }
    })

    // Hide suggestions when clicking outside
    document.addEventListener('click', function (event) {
      if (!event.target.closest('.search-container')) {
        hideSuggestions()
      }
    })
  </script>
  
</html>
